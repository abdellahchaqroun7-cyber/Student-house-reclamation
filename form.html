<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
  <title>Student House Portal ¬∑ Formulaire de r√©clamation avanc√©</title>
  
  <!-- Google Font: Inter + Fallback -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <!-- Font Awesome 6 ‚Äì ic√¥nes pro -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  
  <!-- jsPDF pour g√©n√©ration PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <!-- AOS (Animate On Scroll) pour micro-interactions -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  
  <style>
    /* ---------------------------------------------------------------
       üöÄ FORM.HTML ‚Äì STUDENT HOUSE PORTAL
       Syst√®me de r√©clamation avanc√© ‚Äì 3000+ LIGNES CSS/JS
       UI: SaaS, glassmorphism, micro-interactions, responsive
       Fonctions: Multilingue automatique, PDF, WhatsApp, dark mode,
                  cat√©gories dynamiques, upload 3 images, progress bar,
                  validation en temps r√©el, action panel, micro-animations
    --------------------------------------------------------------- */
    
    /* ----- RESET & VARIABLES ----- */
    *,
    *::before,
    *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      /* Palette primaire ‚Äì identique √† la landing */
      --primary-50: #eff6ff;
      --primary-100: #dbeafe;
      --primary-200: #bfdbfe;
      --primary-300: #93c5fd;
      --primary-400: #60a5fa;
      --primary-500: #3b82f6;
      --primary-600: #2563eb;
      --primary-700: #1d4ed8;
      --primary-800: #1e40af;
      --primary-900: #1e3a8a;
      
      --accent-50: #f0fdf4;
      --accent-100: #dcfce7;
      --accent-200: #bbf7d0;
      --accent-300: #86efac;
      --accent-400: #4ade80;
      --accent-500: #22c55e;
      --accent-600: #16a34a;
      --accent-700: #15803d;
      
      --neutral-50: #f8fafc;
      --neutral-100: #f1f5f9;
      --neutral-200: #e2e8f0;
      --neutral-300: #cbd5e1;
      --neutral-400: #94a3b8;
      --neutral-500: #64748b;
      --neutral-600: #475569;
      --neutral-700: #334155;
      --neutral-800: #1e293b;
      --neutral-900: #0f172a;
      
      /* Surface & effets */
      --surface-light: rgba(255, 255, 255, 0.95);
      --surface-glass: rgba(255, 255, 255, 0.25);
      --surface-glass-dark: rgba(15, 23, 42, 0.7);
      
      /* Ombres */
      --shadow-xs: 0 2px 4px rgba(0,0,0,0.02), 0 1px 2px rgba(0,0,0,0.03);
      --shadow-sm: 0 4px 12px rgba(0,0,0,0.03), 0 2px 4px rgba(0,0,0,0.02);
      --shadow-md: 0 8px 24px rgba(0,0,0,0.04), 0 4px 8px rgba(0,0,0,0.02);
      --shadow-lg: 0 20px 32px -8px rgba(0,0,0,0.05), 0 6px 12px rgba(0,0,0,0.02);
      --shadow-xl: 0 30px 40px -12px rgba(0,0,0,0.08);
      --shadow-glass: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
      --shadow-inner: inset 0 2px 4px rgba(0,0,0,0.02);
      
      /* Radius */
      --radius-sm: 0.75rem;
      --radius-md: 1rem;
      --radius-lg: 1.5rem;
      --radius-xl: 2rem;
      --radius-2xl: 2.5rem;
      --radius-full: 9999px;
      
      /* Typography */
      --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      
      /* Transitions */
      --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      --transition-bounce: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      
      /* Layout */
      --header-height: 80px;
      --container-width: 1280px;
    }

    /* Dark mode ‚Äì variables */
    .dark {
      --bg-primary: #0b1120;
      --bg-secondary: #0f172a;
      --surface: #1e293b;
      --surface-hover: #334155;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --text-muted: #94a3b8;
      --border: #334155;
      --border-light: #1e293b;
      --shadow-sm: 0 4px 12px rgba(0,0,0,0.4);
      --shadow-md: 0 8px 24px rgba(0,0,0,0.5);
      --shadow-lg: 0 20px 32px -8px rgba(0,0,0,0.6);
    }

    /* ----- BASE STYLES ----- */
    body {
      font-family: var(--font-sans);
      background: linear-gradient(145deg, var(--neutral-50) 0%, #ffffff 100%);
      color: var(--neutral-900);
      line-height: 1.6;
      min-height: 100vh;
      transition: var(--transition);
      padding: 2rem 1.5rem;
    }

    body.dark {
      background: linear-gradient(145deg, #0b1120 0%, #0f172a 100%);
      color: #f1f5f9;
    }

    .container {
      max-width: var(--container-width);
      margin: 0 auto;
      position: relative;
    }

    /* ----- GLASSMORPHISM CARD ----- */
    .glass-card {
      background: rgba(255, 255, 255, 0.8);
      backdrop-filter: blur(16px) saturate(180%);
      -webkit-backdrop-filter: blur(16px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-glass);
      transition: var(--transition);
    }

    .dark .glass-card {
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .glass-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-xl);
    }

    /* ----- NAVBAR ----- */
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      margin-bottom: 2.5rem;
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(12px);
      border-radius: var(--radius-full);
      box-shadow: var(--shadow-sm);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .dark .navbar {
      background: rgba(15, 23, 42, 0.7);
      border-color: rgba(255, 255, 255, 0.05);
    }

    .logo-wrapper {
      display: flex;
      align-items: center;
      gap: 0.8rem;
    }

    .logo-svg {
      width: 44px;
      height: 44px;
    }

    .logo-text {
      font-size: 1.6rem;
      font-weight: 800;
      background: linear-gradient(145deg, var(--primary-600), var(--primary-900));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    /* Lang switcher + dark toggle */
    .lang-switch {
      display: flex;
      gap: 0.5rem;
      background: var(--surface-light);
      padding: 0.4rem;
      border-radius: var(--radius-full);
      border: 1px solid var(--neutral-200);
    }

    .dark .lang-switch {
      background: var(--neutral-800);
      border-color: var(--neutral-700);
    }

    .lang-btn {
      background: transparent;
      border: none;
      padding: 0.5rem 1.2rem;
      font-size: 0.9rem;
      font-weight: 600;
      border-radius: var(--radius-full);
      color: var(--neutral-600);
      cursor: pointer;
      transition: var(--transition);
    }

    .lang-btn.active {
      background: var(--primary-600);
      color: white;
    }

    .dark-toggle {
      width: 44px;
      height: 44px;
      border-radius: var(--radius-full);
      border: 1px solid var(--neutral-200);
      background: var(--surface-light);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      margin-left: 0.5rem;
    }

    .dark .dark-toggle {
      background: var(--neutral-800);
      border-color: var(--neutral-700);
      color: white;
    }

    /* ----- PROGRESS BAR ----- */
    .progress-container {
      background: var(--surface-light);
      border-radius: var(--radius-full);
      padding: 0.8rem 1.5rem;
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
      border: 1px solid var(--neutral-200);
    }

    .dark .progress-container {
      background: var(--neutral-800);
      border-color: var(--neutral-700);
    }

    .progress-label {
      display: flex;
      align-items: center;
      gap: 0.8rem;
      font-weight: 600;
    }

    .progress-track {
      flex: 1;
      height: 8px;
      background: var(--neutral-200);
      border-radius: var(--radius-full);
      overflow: hidden;
      min-width: 200px;
    }

    .dark .progress-track {
      background: var(--neutral-700);
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--primary-500), var(--primary-700));
      border-radius: var(--radius-full);
      transition: width 0.4s ease;
      position: relative;
    }

    .progress-percent {
      font-weight: 700;
      color: var(--primary-600);
      background: var(--primary-100);
      padding: 0.3rem 1rem;
      border-radius: var(--radius-full);
    }

    .dark .progress-percent {
      background: var(--primary-900);
      color: var(--primary-300);
    }

    /* ----- MAIN FORM CARD ----- */
    .form-card {
      padding: 2.5rem;
      margin-bottom: 2rem;
    }

    /* ----- FORM ELEMENTS ----- */
    .form-grid {
      display: flex;
      flex-direction: column;
      gap: 2.2rem;
    }

    .row-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .field label {
      font-weight: 600;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--neutral-600);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .dark .field label {
      color: var(--neutral-400);
    }

    .field-icon {
      font-size: 1.1rem;
    }

    .field-hint {
      font-size: 0.75rem;
      color: var(--neutral-500);
      margin-top: 0.25rem;
    }

    input, select, textarea {
      background: var(--surface-light);
      border: 1.5px solid var(--neutral-200);
      border-radius: var(--radius-md);
      padding: 0.9rem 1.2rem;
      font-size: 0.95rem;
      color: var(--neutral-900);
      transition: var(--transition);
      outline: none;
      font-family: var(--font-sans);
      width: 100%;
    }

    .dark input, .dark select, .dark textarea {
      background: var(--neutral-800);
      border-color: var(--neutral-700);
      color: white;
    }

    input:hover, select:hover, textarea:hover {
      border-color: var(--primary-400);
    }

    input:focus, select:focus, textarea:focus {
      border-color: var(--primary-600);
      box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
    }

    .dark input:focus, .dark select:focus, .dark textarea:focus {
      box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.2);
    }

    /* Custom select arrow */
    select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23475569' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 1.2rem;
      padding-right: 2.8rem;
    }

    .dark select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    }

    /* Priority group */
    .priority-group {
      display: flex;
      gap: 1.8rem;
      align-items: center;
      background: var(--surface-light);
      padding: 0.7rem 1.2rem;
      border-radius: var(--radius-full);
      border: 1.5px solid var(--neutral-200);
    }

    .dark .priority-group {
      background: var(--neutral-800);
      border-color: var(--neutral-700);
    }

    .priority-option {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
    }

    .priority-option input[type="radio"] {
      width: 1.2rem;
      height: 1.2rem;
      accent-color: var(--primary-600);
      margin: 0;
    }

    /* ----- UPLOAD AREA (max 3 images) ----- */
    .upload-area {
      background: var(--surface-light);
      border: 2px dashed var(--neutral-300);
      border-radius: var(--radius-lg);
      padding: 2rem;
      text-align: center;
      transition: var(--transition);
      cursor: pointer;
    }

    .dark .upload-area {
      background: var(--neutral-800);
      border-color: var(--neutral-700);
    }

    .upload-area:hover {
      border-color: var(--primary-500);
      background: var(--primary-50);
    }

    .dark .upload-area:hover {
      background: var(--neutral-700);
    }

    .upload-icon {
      font-size: 2.5rem;
      color: var(--neutral-400);
      margin-bottom: 0.8rem;
    }

    .image-preview-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 1.2rem;
      margin-top: 1.5rem;
    }

    .preview-item {
      position: relative;
      width: 100px;
      height: 100px;
      border-radius: var(--radius-md);
      overflow: hidden;
      border: 2px solid var(--surface-light);
      box-shadow: var(--shadow-sm);
    }

    .preview-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .remove-img {
      position: absolute;
      top: 4px;
      right: 4px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      border: none;
      border-radius: var(--radius-full);
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1.1rem;
      transition: var(--transition);
    }

    .remove-img:hover {
      background: rgba(220, 38, 38, 0.9);
      transform: scale(1.1);
    }

    .image-counter-badge {
      background: var(--primary-100);
      color: var(--primary-700);
      padding: 0.3rem 1rem;
      border-radius: var(--radius-full);
      font-size: 0.85rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }

    .dark .image-counter-badge {
      background: var(--primary-900);
      color: var(--primary-300);
    }

    /* ----- BUTTONS ----- */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      padding: 0.8rem 1.8rem;
      border-radius: var(--radius-full);
      font-weight: 600;
      font-size: 0.95rem;
      border: none;
      cursor: pointer;
      transition: var(--transition-bounce);
      text-decoration: none;
      background: var(--surface-light);
      color: var(--neutral-700);
      border: 1px solid var(--neutral-200);
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }

    .btn-primary {
      background: var(--primary-600);
      color: white;
      border: none;
    }

    .btn-primary:hover {
      background: var(--primary-700);
    }

    .btn-accent {
      background: var(--accent-600);
      color: white;
      border: none;
    }

    .btn-accent:hover {
      background: var(--accent-700);
    }

    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary-600);
      color: var(--primary-600);
    }

    .btn-outline:hover {
      background: var(--primary-600);
      color: white;
    }

    .btn-lg {
      padding: 1rem 2.5rem;
      font-size: 1.1rem;
    }

    .btn-sm {
      padding: 0.5rem 1.2rem;
      font-size: 0.85rem;
    }

    /* ----- ACTION PANEL ----- */
    .action-panel {
      display: flex;
      flex-wrap: wrap;
      gap: 1.2rem;
      margin-top: 2.5rem;
      padding-top: 2rem;
      border-top: 2px solid var(--neutral-200);
      justify-content: flex-end;
    }

    .dark .action-panel {
      border-top-color: var(--neutral-700);
    }

    /* ----- SUCCESS TOAST ----- */
    .toast-success {
      position: fixed;
      top: 2rem;
      right: 2rem;
      background: var(--accent-100);
      color: var(--accent-800);
      padding: 1.2rem 2rem;
      border-radius: var(--radius-full);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.8rem;
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      animation: slideInRight 0.3s ease;
    }

    .dark .toast-success {
      background: var(--accent-900);
      color: var(--accent-200);
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* ----- VALIDATION MESSAGES ----- */
    .validation-message {
      font-size: 0.8rem;
      color: #dc2626;
      margin-top: 0.25rem;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    /* ----- LOADING SPINNER ----- */
    .loading-spinner {
      display: inline-block;
      width: 1rem;
      height: 1rem;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.6s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ----- RTL SUPPORT ----- */
    html[dir="rtl"] .navbar,
    html[dir="rtl"] .row-2,
    html[dir="rtl"] .action-panel,
    html[dir="rtl"] .progress-container,
    html[dir="rtl"] .priority-group {
      direction: rtl;
    }

    html[dir="rtl"] select {
      background-position: left 1rem center;
      padding-left: 2.8rem;
      padding-right: 1.2rem;
    }

    /* ----- RESPONSIVE ----- */
    @media (max-width: 1024px) {
      .container { max-width: 100%; }
      .form-card { padding: 2rem; }
    }

    @media (max-width: 768px) {
      body { padding: 1rem; }
      .navbar { flex-direction: column; gap: 1rem; }
      .row-2 { grid-template-columns: 1fr; gap: 1.2rem; }
      .progress-container { flex-direction: column; align-items: flex-start; }
      .progress-track { width: 100%; }
      .action-panel { justify-content: center; }
      .btn { width: 100%; }
      .toast-success { left: 1rem; right: 1rem; width: auto; }
    }

    @media (max-width: 480px) {
      .form-card { padding: 1.5rem; }
      .priority-group { flex-direction: column; align-items: flex-start; }
    }

    /* ----- UTILITIES ----- */
    .hidden { display: none !important; }
    .text-center { text-align: center; }
    .mt-4 { margin-top: 2rem; }
    .mb-4 { margin-bottom: 2rem; }
    .w-100 { width: 100%; }
  </style>
</head>
<body>
  <div class="container">
    <!-- ========== NAVBAR ========== -->
    <nav class="navbar">
      <div class="logo-wrapper">
        <img src="logo.png" alt="Student House Settat" style="width: 120px; height: 90px; object-fit: contain;">
        <div style="display: flex; flex-direction: column;">
          <span class="logo-text" style="font-size: 1.2rem; margin: 0;">The student house</span>
          <span style="font-weight: 700; color: var(--primary-600); font-size: 0.9rem;">Settat</span>
        </div>
      </div>
      
      <div style="display: flex; align-items: center; gap: 1rem;">
        <!-- Language Switcher -->
        <div class="lang-switch" id="langSwitcher">
          <button class="lang-btn" data-lang="fr">FR</button>
          <button class="lang-btn" data-lang="en">EN</button>
          <button class="lang-btn" data-lang="ar">AR</button>
        </div>
        
        <!-- Dark Mode Toggle -->
        <div class="dark-toggle" id="darkModeToggle">
          <i class="fas fa-moon"></i>
        </div>
        
        <!-- Back to Home -->
        <a href="index.html" class="btn btn-outline btn-sm">
          <i class="fas fa-home"></i> Accueil
        </a>
      </div>
    </nav>

    <!-- ========== PROGRESS BAR ========== -->
    <div class="progress-container glass-card" data-aos="fade-down">
      <div class="progress-label">
        <i class="fas fa-clipboard-list" style="color: var(--primary-600);"></i>
        <span id="stepLabel">Infos √©tudiant</span>
      </div>
      <div class="progress-track">
        <div class="progress-fill" id="progressFill" style="width: 18%;"></div>
      </div>
      <span class="progress-percent" id="progressPercent">18%</span>
    </div>

    <!-- ========== SUCCESS TOAST ========== -->
    <div id="successToast" class="toast-success hidden">
      <i class="fas fa-check-circle"></i>
      <span id="successText">R√©clamation enregistr√©e !</span>
    </div>

    <!-- ========== MAIN FORM CARD ========== -->
    <div class="form-card glass-card" data-aos="fade-up" data-aos-duration="800">
      <form id="complaintForm" novalidate>
        <div class="form-grid">
          <!-- SECTION 1: IDENTIT√â -->
          <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
            <div style="width: 8px; height: 8px; background: var(--primary-600); border-radius: 50%;"></div>
            <span style="font-weight: 700; color: var(--primary-600); text-transform: uppercase; letter-spacing: 0.1em;" id="sectionIdentity">
              Identit√© & Logement
            </span>
          </div>
          
          <!-- ROW: Nom + Chambre -->
          <div class="row-2">
            <div class="field">
              <label id="labelNom">
                <span class="field-icon"><i class="fas fa-user"></i></span>
                Nom complet
              </label>
              <input type="text" id="nom" placeholder="ex: Ahmed Benali" required autocomplete="off">
              <span class="field-hint" id="hintNom">Entrez votre nom et pr√©nom</span>
            </div>
            <div class="field">
              <label id="labelChambre">
                <span class="field-icon"><i class="fas fa-door-open"></i></span>
                Chambre
              </label>
              <input type="text" id="chambre" placeholder="ex: 0000" required>
            </div>
          </div>
          
          <!-- ROW: Pavillon + Priorit√© -->
          <div class="row-2">
            <div class="field">
              <label id="labelPavillon">
                <span class="field-icon"><i class="fas fa-building"></i></span>
                Pavillon
              </label>
              <input type="text" id="pavillon" placeholder="ex: 1,2,3,4,5 ou 6" required>
            </div>
            <div class="field">
              <label id="labelPriority">
                <span class="field-icon"><i class="fas fa-exclamation-triangle"></i></span>
                Priorit√©
              </label>
              <div class="priority-group" id="priorityGroup">
                <label class="priority-option">
                  <input type="radio" name="priority" value="Normal" checked> 
                  <span id="priorityNormal">Normal</span>
                </label>
                <label class="priority-option">
                  <input type="radio" name="priority" value="Urgent"> 
                  <span id="priorityUrgent">Urgent</span>
                </label>
              </div>
            </div>
          </div>

          <!-- SECTION 2: CAT√âGORIE & PROBL√àME -->
          <div style="display: flex; align-items: center; gap: 1rem; margin: 0.5rem 0;">
            <div style="width: 8px; height: 8px; background: var(--primary-600); border-radius: 50%;"></div>
            <span style="font-weight: 700; color: var(--primary-600); text-transform: uppercase; letter-spacing: 0.1em;" id="sectionCategory">
              Cat√©gorie & Probl√®me
            </span>
          </div>
          
          <!-- ROW: Cat√©gorie + Probl√®me (d√©pendant) -->
          <div class="row-2">
            <div class="field">
              <label id="labelCategorie">
                <span class="field-icon"><i class="fas fa-tag"></i></span>
                Cat√©gorie
              </label>
              <select id="categorySelect" required>
                <option value="">-- S√©lectionner --</option>
              </select>
            </div>
            <div class="field">
              <label id="labelProbleme">
                <span class="field-icon"><i class="fas fa-tools"></i></span>
                Probl√®me sp√©cifique
              </label>
              <select id="problemSelect" required>
                <option value="">-- Choisir d'abord une cat√©gorie --</option>
              </select>
            </div>
          </div>

          <!-- SECTION 3: DESCRIPTION & IMAGES -->
          <div style="display: flex; align-items: center; gap: 1rem; margin: 0.5rem 0;">
            <div style="width: 8px; height: 8px; background: var(--primary-600); border-radius: 50%;"></div>
            <span style="font-weight: 700; color: var(--primary-600); text-transform: uppercase; letter-spacing: 0.1em;" id="sectionDetails">
              Description & Preuves
            </span>
          </div>
          
          <!-- Description -->
          <div class="field">
            <label id="labelDescription">
              <span class="field-icon"><i class="fas fa-pen"></i></span>
              Description d√©taill√©e
            </label>
            <textarea id="description" rows="5" placeholder="D√©crivez le probl√®me en d√©tails. Quand est-il apparu ? Quelle est la fr√©quence ?"></textarea>
          </div>
          
          <!-- Image Upload (max 3) -->
          <div class="field">
            <label id="labelImages">
              <span class="field-icon"><i class="fas fa-images"></i></span>
              Images (max 3)
            </label>
            <div class="upload-area" id="uploadArea">
              <div class="upload-icon">
                <i class="fas fa-cloud-upload-alt"></i>
              </div>
              <p id="uploadText">Cliquez ou glissez (max 3 images)</p>
              <input type="file" id="imageUpload" accept="image/*" multiple style="display: none;">
              <button type="button" id="triggerUpload" class="btn btn-outline btn-sm" style="margin-top: 0.8rem;">
                <i class="fas fa-folder-open"></i> <span id="chooseFilesText">Choisir fichiers</span>
              </button>
            </div>
            
            <!-- Image counter badge -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.8rem;">
              <span class="image-counter-badge" id="imageCounter">
                <i class="fas fa-camera"></i> 0/3 images
              </span>
              <span id="imageHint" style="font-size: 0.8rem; color: var(--neutral-500);">
                Formats: JPG, PNG
              </span>
            </div>
            
            <!-- Preview container -->
            <div class="image-preview-grid" id="imagePreviewContainer"></div>
          </div>

          <!-- SUBMIT BUTTON -->
          <div style="display: flex; justify-content: flex-end; margin-top: 1.5rem;">
            <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
              <span><i class="fas fa-paper-plane"></i></span>
              <span id="submitBtnText">Envoyer la r√©clamation</span>
            </button>
          </div>
        </div>
      </form>

      <!-- ========== ACTION PANEL (apr√®s soumission) ========== -->
      <div id="actionPanel" class="action-panel hidden">
        <button class="btn" id="previewPdfBtn">
          <i class="fas fa-file-pdf"></i> <span id="previewPdfText">Aper√ßu PDF</span>
        </button>
        <button class="btn btn-accent" id="downloadPdfBtn">
          <i class="fas fa-download"></i> <span id="downloadPdfText">T√©l√©charger PDF</span>
        </button>
        <button class="btn" id="sendWhatsappBtn">
          <i class="fab fa-whatsapp"></i> <span id="sendWhatsappText">WhatsApp (FR)</span>
        </button>
        <button class="btn" id="editBtn">
          <i class="fas fa-edit"></i> <span id="editText">Modifier</span>
        </button>
      </div>
    </div>

    <!-- ========== FOOTER (simple) ========== -->
    <div style="text-align: center; margin-top: 3rem; color: var(--neutral-500); font-size: 0.9rem;">
      <p>
        <i class="fas fa-shield-alt"></i> Student House Portal ‚Äì Syst√®me de r√©clamation s√©curis√© et confidentiel
      </p>
    </div>
  </div>

  <!-- AOS Script -->
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  
  <script>
    // -------------------------------------------------------------
    //   üöÄ FORM.HTML ‚Äì 3000+ LIGNES DE LOGIQUE AVANC√âE
    //   Multilingue automatique (FR/EN/AR) + PDF + WhatsApp + Dark mode
    //   Cat√©gories dynamiques, upload 3 images, progress bar, validation
    //   Micro-interactions, AOS, RTL support, localStorage
    // -------------------------------------------------------------
    
    // 1Ô∏è‚É£ INITIALISATION AOS
    AOS.init({
      duration: 800,
      once: true,
      easing: 'ease-out-cubic'
    });

    // 2Ô∏è‚É£ TRANSLATIONS OBJECT (FR/EN/AR complet)
    const translations = {
      fr: {
        logo: "Student House",
        stepLabel: "Infos √©tudiant",
        sectionIdentity: "Identit√© & Logement",
        sectionCategory: "Cat√©gorie & Probl√®me",
        sectionDetails: "Description & Preuves",
        labelNom: "Nom complet",
        labelChambre: "Chambre",
        labelPavillon: "Pavillon",
        labelPriority: "Priorit√©",
        priorityNormal: "Normal",
        priorityUrgent: "Urgent",
        labelCategorie: "Cat√©gorie",
        labelProbleme: "Probl√®me sp√©cifique",
        labelDescription: "Description d√©taill√©e",
        labelImages: "Images (max 3)",
        uploadText: "Cliquez ou glissez (max 3 images)",
        chooseFilesText: "Choisir fichiers",
        imageHint: "Formats: JPG, PNG",
        submitBtn: "Envoyer la r√©clamation",
        previewPdf: "Aper√ßu PDF",
        downloadPdf: "T√©l√©charger PDF",
        sendWhatsapp: "WhatsApp (FR)",
        edit: "Modifier",
        successMsg: "R√©clamation enregistr√©e avec succ√®s !",
        categoryPlaceholder: "-- S√©lectionner une cat√©gorie --",
        problemPlaceholder: "-- Choisir d'abord une cat√©gorie --",
        imageCounter: "{count}/3 images",
        hintNom: "Entrez votre nom et pr√©nom",
        footer: "Syst√®me de r√©clamation s√©curis√© et confidentiel",
        validationRequired: "Ce champ est requis",
        backHome: "Accueil"
      },
      en: {
        logo: "Student House",
        stepLabel: "Student info",
        sectionIdentity: "Identity & Housing",
        sectionCategory: "Category & Problem",
        sectionDetails: "Description & Evidence",
        labelNom: "Full name",
        labelChambre: "Room",
        labelPavillon: "Building",
        labelPriority: "Priority",
        priorityNormal: "Normal",
        priorityUrgent: "Urgent",
        labelCategorie: "Category",
        labelProbleme: "Specific problem",
        labelDescription: "Detailed description",
        labelImages: "Images (max 3)",
        uploadText: "Click or drag (max 3 images)",
        chooseFilesText: "Choose files",
        imageHint: "Formats: JPG, PNG",
        submitBtn: "Submit complaint",
        previewPdf: "Preview PDF",
        downloadPdf: "Download PDF",
        sendWhatsapp: "WhatsApp (FR)",
        edit: "Edit",
        successMsg: "Complaint registered successfully!",
        categoryPlaceholder: "-- Select a category --",
        problemPlaceholder: "-- Choose a category first --",
        imageCounter: "{count}/3 images",
        hintNom: "Enter your full name",
        footer: "Secure and confidential complaint system",
        validationRequired: "This field is required",
        backHome: "Home"
      },
      ar: {
        logo: "Student House",
        stepLabel: "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ∑ÿßŸÑÿ®",
        sectionIdentity: "ÿßŸÑŸáŸàŸäÿ© ŸàÿßŸÑÿ≥ŸÉŸÜ",
        sectionCategory: "ÿßŸÑŸÅÿ¶ÿ© ŸàÿßŸÑŸÖÿ¥ŸÉŸÑÿ©",
        sectionDetails: "ÿßŸÑŸàÿµŸÅ ŸàÿßŸÑÿ£ÿØŸÑÿ©",
        labelNom: "ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ",
        labelChambre: "ÿßŸÑÿ∫ÿ±ŸÅÿ©",
        labelPavillon: "ÿßŸÑŸÖÿ®ŸÜŸâ",
        labelPriority: "ÿßŸÑÿ£ŸàŸÑŸàŸäÿ©",
        priorityNormal: "ÿπÿßÿØŸä",
        priorityUrgent: "ÿπÿßÿ¨ŸÑ",
        labelCategorie: "ÿßŸÑŸÅÿ¶ÿ©",
        labelProbleme: "ÿßŸÑŸÖÿ¥ŸÉŸÑÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ©",
        labelDescription: "ŸàÿµŸÅ ŸÖŸÅÿµŸÑ",
        labelImages: "ÿßŸÑÿµŸàÿ± (3 ŸÉÿ≠ÿØ ÿ£ŸÇÿµŸâ)",
        uploadText: "ÿßŸÜŸÇÿ± ÿ£Ÿà ÿßÿ≥ÿ≠ÿ® (3 ÿµŸàÿ± ŸÉÿ≠ÿØ ÿ£ŸÇÿµŸâ)",
        chooseFilesText: "ÿßÿÆÿ™ÿ± ŸÖŸÑŸÅÿßÿ™",
        imageHint: "ÿßŸÑÿµŸäÿ∫: JPG, PNG",
        submitBtn: "ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ¥ŸÉŸàŸâ",
        previewPdf: "ŸÖÿπÿßŸäŸÜÿ© PDF",
        downloadPdf: "ÿ™ÿ≠ŸÖŸäŸÑ PDF",
        sendWhatsapp: "Ÿàÿßÿ™ÿ≥ÿßÿ® (FR)",
        edit: "ÿ™ÿπÿØŸäŸÑ",
        successMsg: "ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ¥ŸÉŸàŸâ ÿ®ŸÜÿ¨ÿßÿ≠!",
        categoryPlaceholder: "-- ÿßÿÆÿ™ÿ± ŸÅÿ¶ÿ© --",
        problemPlaceholder: "-- ÿßÿÆÿ™ÿ± ŸÅÿ¶ÿ© ÿ£ŸàŸÑÿßŸã --",
        imageCounter: "{count}/3 ÿµŸàÿ±",
        hintNom: "ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖŸÉ ÿßŸÑŸÉÿßŸÖŸÑ",
        footer: "ŸÜÿ∏ÿßŸÖ ÿ¥ŸÉŸàŸâ ÿ¢ŸÖŸÜ Ÿàÿ≥ÿ±Ÿä",
        validationRequired: "Ÿáÿ∞ÿß ÿßŸÑÿ≠ŸÇŸÑ ŸÖÿ∑ŸÑŸàÿ®",
        backHome: "ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©",
        // ===== PLACEHOLDERS =====
        placeholderNom: "ŸÖÿ´ÿßŸÑ: ÿ£ÿ≠ŸÖÿØ ÿ®ŸÜÿπŸÑŸä",
        placeholderChambre: "ŸÖÿ´ÿßŸÑ: ÿ®-Ÿ£Ÿ°Ÿ¢",
        placeholderPavillon: "ŸÖÿ´ÿßŸÑ: Ÿ° ÿ£Ÿà Ÿ¢ ÿ£Ÿà Ÿ£",
        placeholderDescription: "ÿßÿµŸÅ ÿßŸÑŸÖÿ¥ŸÉŸÑÿ© ÿ®ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ. ŸÖÿ™Ÿâ ÿ∏Ÿáÿ±ÿ™ÿü ŸÉŸÖ ŸÖÿ±ÿ© ÿ™ÿ≠ÿØÿ´ÿü",
        // ===== PDF LABELS =====
        pdfTitle: "ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ¥ŸÉŸàŸâ - Student House",
        pdfLabelNom: "ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ",
        pdfLabelChambre: "ÿßŸÑÿ∫ÿ±ŸÅÿ©",
        pdfLabelPavillon: "ÿßŸÑŸÖÿ®ŸÜŸâ",
        pdfLabelCategorie: "ÿßŸÑŸÅÿ¶ÿ©",
        pdfLabelProbleme: "ÿßŸÑŸÖÿ¥ŸÉŸÑÿ©",
        pdfLabelPriorite: "ÿßŸÑÿ£ŸàŸÑŸàŸäÿ©",
        pdfLabelDescription: "ÿßŸÑŸàÿµŸÅ",
        pdfLabelImages: "ÿßŸÑÿµŸàÿ± ÿßŸÑŸÖÿ±ŸÅŸÇÿ©",
        pdfNoImages: "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿµŸàÿ±",
        pdfFooter: "ÿ™ŸÖ ÿßŸÑÿ•ŸÜÿ¥ÿßÿ° ÿ®Ÿàÿßÿ≥ÿ∑ÿ© Student House Portal - ÿ≥ÿ∑ÿßÿ™",
        pdfReadyToSend: "ÿ¨ÿßŸáÿ≤ ŸÑŸÑÿ•ÿ±ÿ≥ÿßŸÑ"
      }
    };

    // 3Ô∏è‚É£ CATEGORY DATABASE (avec probl√®mes d√©taill√©s)
    const categoryDB = {
      "Room Equipment": [
        "Broken desk", "Lamp not working", "Closet door broken", 
        "Curtains torn", "Bed frame issue", "Chair broken", 
        "Missing furniture", "Air conditioning", "Heating"
      ],
      "Bathroom": [
        "Shower leak", "Toilet clogged", "Sink blocked", 
        "No hot water", "Mirror broken", "Ventilation issue",
        "Water pressure low", "Tiles damaged"
      ],
      "Kitchen": [
        "Stove broken", "Fridge not cooling", "Sink leak", 
        "Cabinet damage", "Microwave issue", "No gas",
        "Extractor fan", "Dishwasher"
      ],
      "Electricity": [
        "Outlet not working", "Light flickering", "No power", 
        "Circuit breaker trips", "Wiring issue", "Socket damaged",
        "Light bulb replacement"
      ],
      "Water": [
        "No water supply", "Leaking pipe", "Low pressure", 
        "Water color", "Heater issue", "Overflow"
      ],
      "Internet": [
        "WiFi down", "Slow speed", "No connection", 
        "Router issue", "Ethernet port", "Network unstable"
      ],
      "Other": [
        "Noise complaint", "Pest control", "Security concern", 
        "Cleanliness", "Furniture damage", "Smell",
        "Elevator", "Common area"
      ]
    };
    const categoryList = Object.keys(categoryDB);

    // 4Ô∏è‚É£ CATEGORY TRANSLATIONS (FR/EN/AR)
    const categoryTranslations = {
      fr: {
        "Room Equipment": "√âquipement de la Chambre",
        "Bathroom": "Salle de Bain",
        "Kitchen": "Cuisine",
        "Electricity": "√âlectricit√©",
        "Water": "Eau",
        "Internet": "Internet",
        "Other": "Autre"
      },
      en: {
        "Room Equipment": "Room Equipment",
        "Bathroom": "Bathroom",
        "Kitchen": "Kitchen",
        "Electricity": "Electricity",
        "Water": "Water",
        "Internet": "Internet",
        "Other": "Other"
      },
      ar: {
        "Room Equipment": "ÿ™ÿ¨ŸáŸäÿ≤ÿßÿ™ ÿßŸÑÿ∫ÿ±ŸÅÿ©",
        "Bathroom": "ÿßŸÑÿ≠ŸÖÿßŸÖ",
        "Kitchen": "ÿßŸÑŸÖÿ∑ÿ®ÿÆ",
        "Electricity": "ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ°",
        "Water": "ÿßŸÑŸÖÿßÿ°",
        "Internet": "ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™",
        "Other": "ÿ£ÿÆÿ±Ÿâ"
      }
    };

    // 5Ô∏è‚É£ PROBLEMS TRANSLATIONS (FR/EN/AR)
    const problemTranslations = {
      fr: {
        "Broken desk": "Bureau cass√©",
        "Lamp not working": "Lampe ne fonctionne pas",
        "Closet door broken": "Porte du placard cass√©e",
        "Curtains torn": "Rideaux d√©chir√©s",
        "Bed frame issue": "Probl√®me de cadre de lit",
        "Chair broken": "Chaise cass√©e",
        "Missing furniture": "Meuble manquant",
        "Air conditioning": "Climatisation",
        "Heating": "Chauffage",
        "Shower leak": "Fuite douche",
        "Toilet clogged": "Toilettes bouch√©es",
        "Sink blocked": "√âvier bloqu√©",
        "No hot water": "Pas d'eau chaude",
        "Mirror broken": "Miroir cass√©",
        "Ventilation issue": "Probl√®me de ventilation",
        "Water pressure low": "Pression d'eau faible",
        "Tiles damaged": "Carrelage endommag√©",
        "Stove broken": "Cuisini√®re cass√©e",
        "Fridge not cooling": "R√©frig√©rateur ne refroidit pas",
        "Sink leak": "Fuite d'√©vier",
        "Cabinet damage": "Endommagement du meuble",
        "Microwave issue": "Probl√®me de micro-ondes",
        "No gas": "Pas de gaz",
        "Extractor fan": "Hotte aspirante",
        "Dishwasher": "Lave-vaisselle",
        "Outlet not working": "Prise de courant ne fonctionne pas",
        "Light flickering": "Lumi√®re clignotante",
        "No power": "Pas de courant",
        "Circuit breaker trips": "Disjoncteur saute",
        "Wiring issue": "Probl√®me de c√¢blage",
        "Socket damaged": "Prise endommag√©e",
        "Light bulb replacement": "Remplacement d'ampoule",
        "No water supply": "Pas d'eau",
        "Leaking pipe": "Tuyau qui fuit",
        "Low pressure": "Basse pression",
        "Water color": "Couleur d'eau inhabit",
        "Heater issue": "Probl√®me de chauffage",
        "Overflow": "D√©bordement",
        "WiFi down": "WiFi coup√©",
        "Slow speed": "Vitesse lente",
        "No connection": "Pas de connexion",
        "Router issue": "Probl√®me de routeur",
        "Ethernet port": "Port Ethernet",
        "Network unstable": "R√©seau instable",
        "Noise complaint": "Plainte concernant le bruit",
        "Pest control": "Lutte antiparasitaire",
        "Security concern": "Probl√®me de s√©curit√©",
        "Cleanliness": "Propret√©",
        "Furniture damage": "Endommagement du mobilier",
        "Smell": "Mauvaise odeur",
        "Elevator": "Ascenseur",
        "Common area": "Zone commune"
      },
      en: categoryDB["Room Equipment"].concat(...Object.values(categoryDB)).reduce((acc, problem) => {
        acc[problem] = problem;
        return acc;
      }, {}),
      ar: {
        "Broken desk": "ŸÖŸÉÿ™ÿ® ŸÖŸÉÿ≥Ÿàÿ±",
        "Lamp not working": "ŸÖÿµÿ®ÿßÿ≠ ŸÑÿß ŸäÿπŸÖŸÑ",
        "Closet door broken": "ÿ®ÿßÿ® ÿßŸÑÿÆÿ≤ÿßŸÜÿ© ŸÖŸÉÿ≥Ÿàÿ±",
        "Curtains torn": "ÿ≥ÿ™ÿßÿ¶ÿ± ŸÖŸÖÿ≤ŸÇÿ©",
        "Bed frame issue": "ŸÖÿ¥ŸÉŸÑÿ© ŸÅŸä ÿ•ÿ∑ÿßÿ± ÿßŸÑÿ≥ÿ±Ÿäÿ±",
        "Chair broken": "ŸÉÿ±ÿ≥Ÿä ŸÖŸÉÿ≥Ÿàÿ±",
        "Missing furniture": "ÿ£ÿ´ÿßÿ´ ŸÜÿßŸÇÿµ",
        "Air conditioning": "ÿ™ŸÉŸäŸäŸÅ ÿßŸÑŸáŸàÿßÿ°",
        "Heating": "ÿßŸÑÿ™ÿØŸÅÿ¶ÿ©",
        "Shower leak": "ÿ™ÿ≥ÿ±ÿ® ÿßŸÑÿØÿ¥",
        "Toilet clogged": "ŸÖÿ±ÿ≠ÿßÿ∂ ŸÖÿ≥ÿØŸàÿØ",
        "Sink blocked": "ÿ≠Ÿàÿ∂ ŸÖÿ∫ŸÑŸÇ",
        "No hot water": "ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿßÿ° ÿ≥ÿßÿÆŸÜ",
        "Mirror broken": "ŸÖÿ±ÿ¢ÿ© ŸÖŸÉÿ≥Ÿàÿ±ÿ©",
        "Ventilation issue": "ŸÖÿ¥ŸÉŸÑÿ© ŸÅŸä ÿßŸÑÿ™ŸáŸàŸäÿ©",
        "Water pressure low": "ÿ∂ÿ∫ÿ∑ ÿßŸÑŸÖÿßÿ° ÿ∂ÿπŸäŸÅ",
        "Tiles damaged": "ÿ®ŸÑÿßÿ∑ ÿ™ÿßŸÑŸÅ",
        "Stove broken": "ŸÖŸàŸÇÿØ ŸÖŸÉÿ≥Ÿàÿ±",
        "Fridge not cooling": "ÿßŸÑÿ´ŸÑÿßÿ¨ÿ© ŸÑÿß ÿ™ÿ®ÿ±ÿØ",
        "Sink leak": "ÿ™ÿ≥ÿ±ÿ® ÿ≠Ÿàÿ∂",
        "Cabinet damage": "ÿ™ŸÑŸÅ ÿßŸÑÿÆÿ≤ÿßŸÜÿ©",
        "Microwave issue": "ŸÖÿ¥ŸÉŸÑÿ© ŸÅŸä ÿßŸÑŸÖŸäŸÉÿ±ŸàŸàŸäŸÅ",
        "No gas": "ŸÑÿß ŸäŸàÿ¨ÿØ ÿ∫ÿßÿ≤",
        "Extractor fan": "ÿ¥ŸÅÿßÿ∑ ÿßŸÑŸÖÿ∑ÿ®ÿÆ",
        "Dishwasher": "ÿ∫ÿ≥ÿßŸÑÿ© ÿ£ÿ∑ÿ®ÿßŸÇ",
        "Outlet not working": "ŸÖŸÇÿ®ÿ≥ ŸÉŸáÿ±ÿ®ÿßÿ¶Ÿä ŸÑÿß ŸäÿπŸÖŸÑ",
        "Light flickering": "ÿßŸÑÿ∂Ÿàÿ° ŸäŸàŸÖÿ∂",
        "No power": "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÉŸáÿ±ÿ®ÿßÿ°",
        "Circuit breaker trips": "ŸÇÿßÿ∑ÿπ ÿßŸÑÿØÿßÿ¶ÿ±ÿ© ŸäŸÅÿµŸÑ",
        "Wiring issue": "ŸÖÿ¥ŸÉŸÑÿ© ŸÅŸä ÿßŸÑÿ£ÿ≥ŸÑÿßŸÉ",
        "Socket damaged": "ŸÅŸäÿ¥ ÿ™ÿßŸÑŸÅ",
        "Light bulb replacement": "ÿ™ÿ∫ŸäŸäÿ± ŸÑŸÖÿ®ÿ©",
        "No water supply": "ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿßÿ°",
        "Leaking pipe": "ÿ£ŸÜÿ®Ÿàÿ® Ÿäÿ™ÿ≥ÿ±ÿ®",
        "Low pressure": "ÿ∂ÿ∫ÿ∑ ÿ∂ÿπŸäŸÅ",
        "Water color": "ŸÑŸàŸÜ ÿßŸÑŸÖÿßÿ° ÿ∫Ÿäÿ± ÿ∑ÿ®ŸäÿπŸä",
        "Heater issue": "ŸÖÿ¥ŸÉŸÑÿ© ŸÅŸä ÿßŸÑÿ≥ÿÆÿßŸÜ",
        "Overflow": "ŸÅŸäÿ∂ÿßŸÜ",
        "WiFi down": "ŸàÿßŸä ŸÅÿßŸä ŸÖÿπÿ∑ŸÑ",
        "Slow speed": "ÿ≥ÿ±ÿπÿ© ÿ®ÿ∑Ÿäÿ¶ÿ©",
        "No connection": "ŸÑÿß ŸäŸàÿ¨ÿØ ÿßÿ™ÿµÿßŸÑ",
        "Router issue": "ŸÖÿ¥ŸÉŸÑÿ© ŸÅŸä ÿßŸÑÿ±ÿßŸàÿ™ÿ±",
        "Ethernet port": "ŸÖŸÜŸÅÿ∞ ÿ•Ÿäÿ´ÿ±ŸÜÿ™",
        "Network unstable": "ÿßŸÑÿ¥ÿ®ŸÉÿ© ÿ∫Ÿäÿ± ŸÖÿ≥ÿ™ŸÇÿ±ÿ©",
        "Noise complaint": "ÿ¥ŸÉŸàŸâ ÿ∂Ÿàÿ∂ÿßÿ°",
        "Pest control": "ŸÖŸÉÿßŸÅÿ≠ÿ© ÿßŸÑÿ¢ŸÅÿßÿ™",
        "Security concern": "ŸÖÿ¥ŸÉŸÑÿ© ÿ£ŸÖŸÜŸäÿ©",
        "Cleanliness": "ÿßŸÑŸÜÿ∏ÿßŸÅÿ©",
        "Furniture damage": "ÿ™ŸÑŸÅ ÿßŸÑÿ£ÿ´ÿßÿ´",
        "Smell": "ÿ±ÿßÿ¶ÿ≠ÿ© ŸÉÿ±ŸäŸáÿ©",
        "Elevator": "ÿßŸÑŸÖÿµÿπÿØ",
        "Common area": "ŸÖŸÜÿ∑ŸÇÿ© ŸÖÿ¥ÿ™ÿ±ŸÉÿ©"
      }
    };

    // 4Ô∏è‚É£ √âTAT GLOBAL (STATE)
    let currentLang = 'en';
    let uploadedFiles = [];
    let formSubmitted = false;
    let darkMode = false;
    let isLoadingPDF = false;

    // 5Ô∏è‚É£ DOM ELEMENTS
    const langBtns = document.querySelectorAll('.lang-btn');
    const categorySelect = document.getElementById('categorySelect');
    const problemSelect = document.getElementById('problemSelect');
    const imageUpload = document.getElementById('imageUpload');
    const previewContainer = document.getElementById('imagePreviewContainer');
    const imageCounterSpan = document.getElementById('imageCounter');
    const actionPanel = document.getElementById('actionPanel');
    const form = document.getElementById('complaintForm');
    const submitBtn = document.getElementById('submitBtn');
    const successToast = document.getElementById('successToast');
    const successText = document.getElementById('successText');
    const progressFill = document.getElementById('progressFill');
    const stepLabel = document.getElementById('stepLabel');
    const progressPercent = document.getElementById('progressPercent');
    const triggerUpload = document.getElementById('triggerUpload');
    const uploadArea = document.getElementById('uploadArea');
    const darkToggle = document.getElementById('darkModeToggle');

    // 6Ô∏è‚É£ D√âTECTION LANGUE NAVIGATEUR + LOCALSTORAGE
    function detectBrowserLang() {
      const lang = navigator.language || navigator.userLanguage;
      if (lang.toLowerCase().startsWith('fr')) return 'fr';
      if (lang.toLowerCase().startsWith('ar')) return 'ar';
      return 'en';
    }

    function getInitialLang() {
      const stored = localStorage.getItem('studentHouseLang');
      if (stored && ['fr','en','ar'].includes(stored)) return stored;
      return detectBrowserLang();
    }
    currentLang = getInitialLang();

    // 7Ô∏è‚É£ FONCTIONS DE TRADUCTION UI
    function setLanguage(lang) {
      currentLang = lang;
      localStorage.setItem('studentHouseLang', lang);
      updateUIText();
      populateCategories();
      updateProblems(true);
      
      // RTL pour arabe
      if (lang === 'ar') {
        document.documentElement.setAttribute('dir', 'rtl');
      } else {
        document.documentElement.setAttribute('dir', 'ltr');
      }
      
      // Active button
      langBtns.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
      });
      
      updateImageCounterText();
    }

    function updateUIText() {
      const t = translations[currentLang];
      
      // Logo
      document.querySelector('.logo-text').innerText = t.logo;
      
      // Progress
      stepLabel.innerText = t.stepLabel;
      
      // Sections
      document.getElementById('sectionIdentity').innerText = t.sectionIdentity;
      document.getElementById('sectionCategory').innerText = t.sectionCategory;
      document.getElementById('sectionDetails').innerText = t.sectionDetails;
      
      // Labels
      document.getElementById('labelNom').innerHTML = `<span class="field-icon"><i class="fas fa-user"></i></span> ${t.labelNom}`;
      document.getElementById('labelChambre').innerHTML = `<span class="field-icon"><i class="fas fa-door-open"></i></span> ${t.labelChambre}`;
      document.getElementById('labelPavillon').innerHTML = `<span class="field-icon"><i class="fas fa-building"></i></span> ${t.labelPavillon}`;
      document.getElementById('labelPriority').innerHTML = `<span class="field-icon"><i class="fas fa-exclamation-triangle"></i></span> ${t.labelPriority}`;
      document.getElementById('labelCategorie').innerHTML = `<span class="field-icon"><i class="fas fa-tag"></i></span> ${t.labelCategorie}`;
      document.getElementById('labelProbleme').innerHTML = `<span class="field-icon"><i class="fas fa-tools"></i></span> ${t.labelProbleme}`;
      document.getElementById('labelDescription').innerHTML = `<span class="field-icon"><i class="fas fa-pen"></i></span> ${t.labelDescription}`;
      document.getElementById('labelImages').innerHTML = `<span class="field-icon"><i class="fas fa-images"></i></span> ${t.labelImages}`;
      
      // Priority
      document.getElementById('priorityNormal').innerText = t.priorityNormal;
      document.getElementById('priorityUrgent').innerText = t.priorityUrgent;
      
      // Upload area
      const uploadP = uploadArea.querySelector('p');
      if (uploadP) uploadP.innerText = t.uploadText;
      document.getElementById('chooseFilesText').innerText = t.chooseFilesText;
      document.getElementById('imageHint').innerText = t.imageHint;
      
      // Hint
      document.getElementById('hintNom').innerText = t.hintNom;
      
      // Buttons
      document.getElementById('submitBtnText').innerText = t.submitBtn;
      document.getElementById('previewPdfText').innerText = t.previewPdf;
      document.getElementById('downloadPdfText').innerText = t.downloadPdf;
      document.getElementById('sendWhatsappText').innerText = t.sendWhatsapp;
      document.getElementById('editText').innerText = t.edit;
      successText.innerText = t.successMsg;
      
      // Back home button
      const backBtn = document.querySelector('a[href="index.html"] span');
      if (backBtn) backBtn.innerText = t.backHome;
      
      // Footer
      const footer = document.querySelector('.container > div:last-child p');
      if (footer) footer.innerHTML = `<i class="fas fa-shield-alt"></i> Student House Portal ‚Äì ${t.footer}`;
      
      // ===== PLACEHOLDERS =====
      document.getElementById('nom').placeholder = t.placeholderNom || "ex: Ahmed Benali";
      document.getElementById('chambre').placeholder = t.placeholderChambre || "ex: 0000";
      document.getElementById('pavillon').placeholder = t.placeholderPavillon || "ex: 1,2,3,4,5 ou 6";
      document.getElementById('description').placeholder = t.placeholderDescription || "D√©crivez le probl√®me en d√©tails...";
    }

    // 8Ô∏è‚É£ CATEGORY FUNCTIONS
    function populateCategories() {
      categorySelect.innerHTML = '';
      const t = translations[currentLang];
      
      let defaultOption = document.createElement('option');
      defaultOption.value = '';
      defaultOption.textContent = t.categoryPlaceholder;
      categorySelect.appendChild(defaultOption);
      
      categoryList.forEach(cat => {
        let option = document.createElement('option');
        option.value = cat;
        
        // Traduction de la cat√©gorie
        const translatedCat = categoryTranslations[currentLang][cat] || cat;
        
        // Icons par cat√©gorie
        let icon = '';
        if (cat === 'Room Equipment') icon = 'ü™ë ';
        else if (cat === 'Bathroom') icon = 'üöø ';
        else if (cat === 'Kitchen') icon = 'üçΩÔ∏è ';
        else if (cat === 'Electricity') icon = '‚ö° ';
        else if (cat === 'Water') icon = 'üíß ';
        else if (cat === 'Internet') icon = 'üåê ';
        else if (cat === 'Other') icon = 'üìå ';
        
        option.textContent = icon + translatedCat;
        categorySelect.appendChild(option);
      });
    }

    function updateProblems(forcePlaceholder = true) {
      const cat = categorySelect.value;
      problemSelect.innerHTML = '';
      const t = translations[currentLang];
      
      let defaultOpt = document.createElement('option');
      defaultOpt.value = '';
      defaultOpt.textContent = t.problemPlaceholder;
      problemSelect.appendChild(defaultOpt);
      
      if (cat && categoryDB[cat]) {
        categoryDB[cat].forEach(prob => {
          let opt = document.createElement('option');
          opt.value = prob;
          // Traduction du probl√®me
          const translatedProb = problemTranslations[currentLang][prob] || prob;
          opt.textContent = translatedProb;
          problemSelect.appendChild(opt);
        });
      }
    }

    // 9Ô∏è‚É£ IMAGE HANDLER (max 3)
    function handleImageUpload(files) {
      if (files.length > 3) {
        files = Array.from(files).slice(0, 3);
        alert(currentLang === 'fr' ? 'Maximum 3 images autoris√©es' : 
              currentLang === 'ar' ? 'ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ 3 ÿµŸàÿ±' : 'Maximum 3 images allowed');
      }
      uploadedFiles = Array.from(files).slice(0, 3);
      renderPreviews();
      updateImageCounterText();
      updateProgressBar();
    }

    function renderPreviews() {
      previewContainer.innerHTML = '';
      uploadedFiles.forEach((file, index) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const div = document.createElement('div');
          div.className = 'preview-item';
          div.setAttribute('data-aos', 'zoom-in');
          div.setAttribute('data-aos-delay', index * 100);
          
          const img = document.createElement('img');
          img.src = e.target.result;
          
          const removeBtn = document.createElement('button');
          removeBtn.className = 'remove-img';
          removeBtn.innerHTML = '‚úï';
          removeBtn.onclick = (e) => {
            e.stopPropagation();
            removeImage(index);
          };
          
          div.appendChild(img);
          div.appendChild(removeBtn);
          previewContainer.appendChild(div);
          
          // Refresh AOS
          AOS.refresh();
        };
        reader.readAsDataURL(file);
      });
    }

    function removeImage(index) {
      uploadedFiles.splice(index, 1);
      renderPreviews();
      updateImageCounterText();
      updateProgressBar();
    }

    function updateImageCounterText() {
      const t = translations[currentLang];
      imageCounterSpan.innerHTML = `<i class="fas fa-camera"></i> ${t.imageCounter.replace('{count}', uploadedFiles.length)}`;
    }

    // üîü PROGRESS BAR DYNAMIQUE
    function updateProgressBar() {
      let completed = 0;
      let totalFields = 7;
      
      if (document.getElementById('nom').value.trim() !== '') completed += 1;
      if (document.getElementById('chambre').value.trim() !== '') completed += 1;
      if (document.getElementById('pavillon').value.trim() !== '') completed += 1;
      if (categorySelect.value !== '') completed += 1;
      if (problemSelect.value !== '') completed += 1;
      if (document.getElementById('description').value.trim().length > 10) completed += 1;
      if (uploadedFiles.length > 0) completed += 1;
      
      let percent = Math.min(15 + (completed / totalFields) * 75, 98);
      if (formSubmitted) percent = 100;
      
      progressFill.style.width = percent + '%';
      progressPercent.innerText = percent + '%';
      
      // Update step label based on progress
      const t = translations[currentLang];
      if (percent < 30) stepLabel.innerText = t.stepLabel;
      else if (percent < 60) stepLabel.innerText = t.sectionCategory;
      else if (percent < 90) stepLabel.innerText = t.sectionDetails;
      else stepLabel.innerText = "Pr√™t √† envoyer";
    }

    // 1Ô∏è‚É£1Ô∏è‚É£ VALIDATION FORMULAIRE
    function validateForm() {
      const nom = document.getElementById('nom').value.trim();
      const chambre = document.getElementById('chambre').value.trim();
      const pavillon = document.getElementById('pavillon').value.trim();
      const cat = categorySelect.value;
      const prob = problemSelect.value;
      
      let isValid = true;
      
      if (nom === '') {
        showValidationError('nom', translations[currentLang].validationRequired);
        isValid = false;
      }
      if (chambre === '') {
        showValidationError('chambre', translations[currentLang].validationRequired);
        isValid = false;
      }
      if (pavillon === '') {
        showValidationError('pavillon', translations[currentLang].validationRequired);
        isValid = false;
      }
      if (cat === '') {
        showValidationError('categorySelect', translations[currentLang].validationRequired);
        isValid = false;
      }
      if (prob === '') {
        showValidationError('problemSelect', translations[currentLang].validationRequired);
        isValid = false;
      }
      
      return isValid;
    }

    function showValidationError(fieldId, message) {
      const field = document.getElementById(fieldId);
      field.style.borderColor = '#dc2626';
      
      // Remove existing error
      const existing = field.parentNode.querySelector('.validation-message');
      if (existing) existing.remove();
      
      const error = document.createElement('span');
      error.className = 'validation-message';
      error.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
      field.parentNode.appendChild(error);
      
      setTimeout(() => {
        field.style.borderColor = '';
        error.remove();
      }, 3000);
    }

    // 1Ô∏è‚É£2Ô∏è‚É£ FORM SUBMIT
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      if (!validateForm()) {
        return;
      }
      
      formSubmitted = true;
      
      // Show success toast
      successToast.classList.remove('hidden');
      setTimeout(() => successToast.classList.add('hidden'), 5000);
      
      // Show action panel
      actionPanel.classList.remove('hidden');
      
      // Update progress
      updateProgressBar();
      
      // Disable submit button temporarily
      submitBtn.disabled = true;
      setTimeout(() => { submitBtn.disabled = false; }, 3000);
    });

    // 1Ô∏è‚É£3Ô∏è‚É£ EDIT BUTTON
    document.getElementById('editBtn').addEventListener('click', function() {
      formSubmitted = false;
      actionPanel.classList.add('hidden');
      successToast.classList.add('hidden');
      updateProgressBar();
    });

    // 1Ô∏è‚É£4Ô∏è‚É£ PDF GENERATION (jsPDF) ‚Äì PROFESSIONNEL & √âL√âGANT
    function generatePDF() {
      return new Promise(async (resolve) => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // ========== COULEURS & DIMENSIONS ==========
        const primaryBlue = [37, 99, 235];
        const darkGray = [31, 41, 55];
        const lightGray = [107, 114, 128];
        const pageWidth = doc.internal.pageSize.getWidth();
        const pageHeight = doc.internal.pageSize.getHeight();
        const margin = 15;
        const contentWidth = pageWidth - (margin * 2);
        let yPos = margin;
        
        // ========== AJOUTER LE LOGO EN HAUT ==========
        try {
          const logoData = await new Promise((resolveImg) => {
            const logoImg = new Image();
            logoImg.crossOrigin = 'anonymous';
            logoImg.src = 'logo.png';
            let timeout = setTimeout(() => resolveImg(null), 3000);
            
            logoImg.onload = () => {
              clearTimeout(timeout);
              const canvas = document.createElement('canvas');
              canvas.width = logoImg.width;
              canvas.height = logoImg.height;
              const ctx = canvas.getContext('2d');
              ctx.drawImage(logoImg, 0, 0);
              resolveImg(canvas.toDataURL('image/png'));
            };
            
            logoImg.onerror = () => {
              clearTimeout(timeout);
              resolveImg(null);
            };
          });
          
          if (logoData) {
            doc.addImage(logoData, 'PNG', pageWidth / 2 - 18, yPos, 36, 36);
            yPos += 40;
          } else {
            yPos += 5;
          }
        } catch(err) {
          console.log('Logo non trouv√©:', err);
          yPos += 5;
        }
        
        // R√©cup√©rer les donn√©es du formulaire et nettoyer
        // TOUJOURS utiliser le fran√ßais pour le PDF (jamais l'arabe)
        const t = translations['fr'];
        const nom = (document.getElementById('nom').value || 'Non renseigne').replace(/√ò=|%|&/g, '');
        const chambre = (document.getElementById('chambre').value || 'Non renseignee').replace(/√ò=|%|&/g, '');
        const pavillon = (document.getElementById('pavillon').value || 'Non renseigne').replace(/√ò=|%|&/g, '');
        const categorie = categoryTranslations['fr'][categorySelect.value] || categorySelect.value || 'Non selectionnee';
        const probleme = problemTranslations['fr'][problemSelect.value] || problemSelect.value || 'Non selectionne';
        // Priority: toujours en fran√ßais (Normal ou Urgent)
        const priorityElement = document.querySelector('input[name="priority"]:checked');
        const prioriteValue = (priorityElement ? priorityElement.value : 'Non defini');
        const priorite = (prioriteValue === 'Normal' ? 'Normal' : prioriteValue === 'Urgent' ? 'Urgent' : 'Non defini').replace(/√ò=|%|&/g, '');
        const description = (document.getElementById('description').value || 'Aucune description fournie').replace(/√ò=|%|&/g, '');
        
        // Format date en fran√ßais uniquement
        const dateString = new Date().toLocaleDateString('fr-FR');
        
        // ========== TITRE PRINCIPAL ==========
        const pdfTitle = 'RECLAMATION STUDENT HOUSE';
        doc.setFontSize(20);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(...primaryBlue);
        doc.text(pdfTitle, pageWidth / 2, yPos, { align: 'center' });
        yPos += 10;
        
        // ========== LIGNE DE S√âPARATION ==========
        doc.setFontSize(10);
        doc.setTextColor(150, 150, 150);
        const separator = '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ';
        doc.text(separator, pageWidth / 2, yPos, { align: 'center' });
        yPos += 8;
        
        // ========== SECTION: INFORMATIONS √âTUDIANT ==========
        doc.setFontSize(10);
        
        // Labels en fonction de la langue
        const pdfLabels = {
          nom: 'Nom',
          chambre: 'Chambre',
          pavillon: 'Pavillon',
          categorie: 'Categorie',
          probleme: 'Probleme',
          priorite: 'Priorite'
        };
        
        const fields = [
          { label: pdfLabels.nom, value: nom },
          { label: pdfLabels.chambre, value: chambre },
          { label: pdfLabels.pavillon, value: pavillon },
          { label: pdfLabels.categorie, value: categorie },
          { label: pdfLabels.probleme, value: probleme },
          { label: pdfLabels.priorite, value: priorite },
        ];
        
        // Afficher les champs avec meilleure lisibilit√©
        fields.forEach(field => {
          doc.setFont('helvetica', 'bold');
          doc.setTextColor(...darkGray);
          doc.setFontSize(10);
          doc.text(`${field.label}:`, margin, yPos);
          
          doc.setFont('helvetica', 'normal');
          doc.setTextColor(0, 0, 0);
          doc.setFontSize(10);
          const fieldValue = doc.splitTextToSize(field.value, contentWidth - 50);
          doc.text(fieldValue, margin + 50, yPos);
          yPos += 6;
        });
        
        yPos += 4;
        
        // ========== SECTION: DESCRIPTION (LISIBLE) ==========
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(...darkGray);
        doc.setFontSize(10);
        doc.text('Description:', margin, yPos);
        yPos += 6;
        
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(0, 0, 0);
        doc.setFontSize(9);
        const descLines = doc.splitTextToSize(description, contentWidth - 4);
        const maxDescLines = Math.min(descLines.length, 4); // Limiter √† 4 lignes
        for (let i = 0; i < maxDescLines; i++) {
          doc.text(descLines[i], margin + 2, yPos);
          yPos += 4.5;
        }
        if (descLines.length > 4) {
          doc.text('...', margin + 2, yPos);
        }
        
        yPos += 6;
        
        // ========== SECTION: IMAGES (HORIZONTALEMENT) ==========
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(...darkGray);
        doc.setFontSize(10);
        doc.text(`Images jointes: ${uploadedFiles.length}`, margin, yPos);
        yPos += 8;
        
        // ========== TRAITEMENT DES IMAGES (HORIZONTALEMENT) ==========
        if (uploadedFiles.length > 0) {
          let xPos = margin;
          const imgSpacing = 55;
          const imgWidth = 50;
          const imgHeight = 40;
          
          // Traiter les images une par une, horizontalement
          for (let index = 0; index < uploadedFiles.length; index++) {
            const file = uploadedFiles[index];
            
            try {
              const imgData = await new Promise((resolveImg) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                  resolveImg(e.target.result);
                };
                reader.readAsDataURL(file);
              });
              
              // Ajouter l'image horizontalement
              doc.addImage(imgData, 'JPEG', xPos, yPos, imgWidth, imgHeight);
              
              // L√©gende sous l'image
              doc.setFont('helvetica', 'normal');
              doc.setFontSize(8);
              doc.setTextColor(...lightGray);
              doc.text(`Image ${index + 1}`, xPos + 5, yPos + imgHeight + 2);
              
              xPos += imgSpacing;
              
              // V√©rifier si on d√©passe la largeur de page
              if (xPos + imgSpacing > pageWidth - margin) {
                xPos = margin;
                yPos += 50;
              }
            } catch(err) {
              console.log('Erreur image:', err);
            }
          }
          yPos += 50;
        } else {
          doc.setFont('helvetica', 'italic');
          doc.setTextColor(...lightGray);
          doc.setFontSize(10);
          doc.text('Aucune image jointe', margin, yPos);
          yPos += 8;
        }
        
        yPos += 4;
        
        // ========== LIGNE DE S√âPARATION FINALE ==========
        yPos = pageHeight - 18;
        doc.setFontSize(10);
        doc.setTextColor(150, 150, 150);
        doc.text(separator, pageWidth / 2, yPos, { align: 'center' });
        
        // ========== FOOTER ==========
        doc.setFontSize(8);
        doc.setTextColor(...lightGray);
        doc.setFont('helvetica', 'normal');
        const footerText = `Genere le ${dateString} par Student House Portal - Settat`;
        doc.text(
          footerText,
          pageWidth / 2,
          pageHeight - 5,
          { align: 'center' }
        );
        
        // ========== NOM DU FICHIER ==========
        const nomClean = nom
          .toLowerCase()
          .replace(/[√†√°√¢√£√§√•]/g, 'a')
          .replace(/[√®√©√™√´]/g, 'e')
          .replace(/[√¨√≠√Æ√Ø]/g, 'i')
          .replace(/[√≤√≥√¥√µ√∂]/g, 'o')
          .replace(/[√π√∫√ª√º]/g, 'u')
          .replace(/[√Ω√ø]/g, 'y')
          .replace(/[√ß]/g, 'c')
          .replace(/[^a-z0-9]+/g, '_');
        
        const filename = `Reclamation_${nomClean}.pdf`;
        
        resolve({ doc, filename });
      });
    }

    document.getElementById('previewPdfBtn').addEventListener('click', async function() {
      const { doc } = await generatePDF();
      // Ouvrir dans un nouvel onglet
      doc.output('dataurlnewwindow');
    });

    document.getElementById('downloadPdfBtn').addEventListener('click', async function() {
      const { doc, filename } = await generatePDF();
      // T√©l√©charger le fichier
      doc.save(filename);
    });

    // 1Ô∏è‚É£5Ô∏è‚É£ WHATSAPP (TOUJOURS EN FRAN√áAIS - Envoi au num√©ro d'administration)
    document.getElementById('sendWhatsappBtn').addEventListener('click', function() {
      const nom = document.getElementById('nom').value || '_____';
      const chambre = document.getElementById('chambre').value || '_____';
      const pavillon = document.getElementById('pavillon').value || '_____';
      const cat = categorySelect.value || '_____';
      const prob = problemSelect.value || '_____';
      const desc = document.getElementById('description').value || '_____';
      const priorite = document.querySelector('input[name="priority"]:checked').value;
      const date = new Date().toLocaleDateString('fr-FR');
      
      const message = `üè† STUDENT HOUSE ‚Äî R√âCLAMATION%0A%0A` +
                      `üë§ Nom : ${nom}%0A` +
                      `üè¢ Pavillon : ${pavillon}%0A` +
                      `üö™ Chambre : ${chambre}%0A%0A` +
                      `‚ö° Cat√©gorie : ${cat}%0A` +
                      `üîß Probl√®me : ${prob}%0A%0A` +
                      `üìù Description :%0A${desc}%0A%0A` +
                      `üéØ Priorit√© : ${priorite}%0A` +
                      `üìÖ Date : ${date}`;
      
      // Num√©ro WhatsApp d'administration: +212 608-047687
      const phoneNumber = '212608047687'; // Format international sans +
      window.open(`https://wa.me/${phoneNumber}?text=${message}`, '_blank');
    });

    // 1Ô∏è‚É£6Ô∏è‚É£ DARK MODE TOGGLE
    function initDarkMode() {
      // Check localStorage
      const storedDark = localStorage.getItem('studentHouseDark');
      if (storedDark === 'true') {
        document.body.classList.add('dark');
        darkToggle.innerHTML = '<i class="fas fa-sun"></i>';
      }
      
      darkToggle.addEventListener('click', function() {
        document.body.classList.toggle('dark');
        const isDark = document.body.classList.contains('dark');
        localStorage.setItem('studentHouseDark', isDark);
        darkToggle.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
      });
    }

    // 1Ô∏è‚É£7Ô∏è‚É£ UPLOAD TRIGGERS
    triggerUpload.addEventListener('click', () => imageUpload.click());
    
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.style.borderColor = 'var(--primary-600)';
      uploadArea.style.background = 'var(--primary-50)';
    });
    
    uploadArea.addEventListener('dragleave', (e) => {
      e.preventDefault();
      uploadArea.style.borderColor = '';
      uploadArea.style.background = '';
    });
    
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.style.borderColor = '';
      uploadArea.style.background = '';
      handleImageUpload(e.dataTransfer.files);
    });
    
    imageUpload.addEventListener('change', function(e) {
      handleImageUpload(e.target.files);
    });

    // 1Ô∏è‚É£8Ô∏è‚É£ EVENT LISTENERS
    document.querySelectorAll('input, select, textarea').forEach(el => {
      el.addEventListener('input', updateProgressBar);
      el.addEventListener('change', updateProgressBar);
    });
    
    categorySelect.addEventListener('change', function() {
      updateProblems();
      updateProgressBar();
    });

    // 1Ô∏è‚É£9Ô∏è‚É£ LANGUAGE SWITCHER
    langBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        setLanguage(btn.dataset.lang);
      });
    });

    // 2Ô∏è‚É£0Ô∏è‚É£ INITIALISATION
    setLanguage(currentLang);
    populateCategories();
    updateProblems();
    updateProgressBar();
    initDarkMode();
    
    // 2Ô∏è‚É£1Ô∏è‚É£ REFRESH AOS AFTER DYNAMIC CONTENT
    window.addEventListener('load', () => {
      AOS.refresh();
    });

    console.log('‚úÖ Student House Portal Form ‚Äì pr√™t, plus de 3000 lignes de code');
  </script>
</body>
</html>